<!DOCTYPE html>
<html>
<head>
  <title>Din-Clean - Configuration</title>
  <meta charset="utf-8">
  <style>
    body { font-family: sans-serif; background: #222; color: #eee; }
    .container { max-width: 500px; margin: 40px auto; background: #333; padding: 24px; border-radius: 8px; box-shadow: 0 2px 8px #0008; }
    h1 { text-align: center; font-size: 1.5em; margin-bottom: 1em; }
    label { display: block; margin: 1.2em 0 0.5em; }
    .option-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1em; }
    .option-row input[type="checkbox"] { transform: scale(1.3); }
    .button-row { text-align: center; margin-top: 2em; }
    button { font-size: 1.1em; padding: 0.5em 2em; border-radius: 4px; border: none; background: #4caf50; color: #fff; cursor: pointer; }
    button:hover { background: #388e3c; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Din-Clean - Réglages</h1>
    <form id="config-form">
      <div class="option-row">
        <label for="show_second_panel">Afficher le deuxième panneau</label>
        <input type="checkbox" id="show_second_panel">
      </div>
      <!-- Ajoutez ici d'autres options si besoin -->
      <div class="button-row">
        <button type="submit">Enregistrer</button>
      </div>
    </form>
  </div>
  <script>
    // Liste des clés supportées (à compléter selon vos besoins)
    const PARAM_KEYS = [
      'show_second_panel',
      // Ajoutez ici les autres clés de configuration à gérer côté JS/C
    ];

    // Charger la config existante
    function loadConfig() {
      let config = {};
      try {
        config = JSON.parse(localStorage.getItem('din_clean_config')) || {};
      } catch (e) {}
      // Valeur par défaut : panneau activé
      if (typeof config.show_second_panel === 'undefined') config.show_second_panel = true;
      return config;
    }

    // Remplir le formulaire avec la config existante
    document.addEventListener('DOMContentLoaded', function() {
      const config = loadConfig();
      document.getElementById('show_second_panel').checked = !!config.show_second_panel;
    });

    // Soumission du formulaire
    document.getElementById('config-form').addEventListener('submit', function(e) {
      e.preventDefault();
      let config = loadConfig();
      // Met à jour uniquement les champs présents dans le formulaire
      config.show_second_panel = document.getElementById('show_second_panel').checked;
      // Ajoutez ici la récupération d'autres champs si besoin
      localStorage.setItem('din_clean_config', JSON.stringify(config));
      // Pour Pebble: renvoyer toute la config à l'app
      var return_to = document.location.search.match(/\breturn_to=([^&]+)/);
      if (return_to) {
        document.location = decodeURIComponent(return_to[1]) + '#' + encodeURIComponent(JSON.stringify(config));
      } else {
        alert('Configuration enregistrée !');
      }
    });
  </script>
</body>
</html>
